<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width" />
    <title>CBRJS: Learn You the Node.js For Much Win!</title>
    <link rel="stylesheet" type="text/css" href="style/markbase.css">
    <link rel="stylesheet" type="text/css" href="style/markthemes.css">
    <link rel="stylesheet" type="text/css" href="style/highlight.css">
    <link rel="stylesheet" type="text/css" href="style/style.css">
    <!--
    <link href='http://fonts.googleapis.com/css?family=Signika+Negative:400,700' rel='stylesheet' type='text/css'>
    -->
  </head>
  <body class="coverflow rv">

    <div id="main">
      <header>
        CBRJS: Learn You The Node.js <i>For Much Win</i>
      </header>

      <article>

      
        <section>
          <h1>Asynchronous JavaScript Patterns</h1>

        </section>
      
        <section>
          <h1><em>Embrace the Async</em></h1>

        </section>
      
        <section>
          <ul>
<li>Defining <em>asynchronous programming</em><ul>
<li>History</li>
<li>Continuation-passing</li>
<li>Benefits</li>
</ul>
</li>
<li>Constructing basic abstractions: series, each, map, memoisation</li>
<li>Advanced abstractions<ul>
<li>EventEmitter</li>
<li>Streams</li>
<li>Promises</li>
<li>Continuables / thunks</li>
</ul>
</li>
<li>Generators for async programming</li>
</ul>

        </section>
      
        <section>
          <h2>In the begining</h2>
<p>Programming was about <em>computing</em></p>
<p>Computers were self-contained number-crunchers</p>
<p>I/O was late to the game</p>

        </section>
      
        <section>
          <h2>I/O is not <em>computing</em></h2>
<p>I/O is what computers wait for</p>
<p>I/O is the bottleneck in the majority of programs</p>

        </section>
      
        <section>
          <h2>I/O is usually hidden</h2>
<div class="highlight"><pre><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Reading file...&quot;</span><span class="o">);</span>
<span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="s">&quot;in.txt&quot;</span><span class="o">));</span>

<span class="k">try</span> <span class="o">{</span>
  <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
  <span class="n">String</span> <span class="n">line</span><span class="o">;</span>

  <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
    <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="o">);</span>

  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">br</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Finished reading file!&quot;</span><span class="o">);</span>
</pre></div>

<p>The programmer isn&#39;t prompted to consider the costs</p>

        </section>
      
        <section>
          <h2>I/O is expensive</h2>
<style>
table#iocost {
  font-size: 15px;
  margin: 20px auto;
}
table#iocost td, table#iocost th {
  padding: 4px 12px;
  margin: 0;
  border-bottom: #333 solid 1px;
}
</style>

<table id="iocost" cellpadding="0" cellspacing="0">
  <thead>
    <tr><th>Class</th><th>Operation</th><th>Time cost</th></tr>
  </thead>
  <tbody>
    <tr>
      <td rowspan="3" style="text-align: center;">Memory</td>
      <td>L1 cache reference:</td>
      <td style="text-align: right;">1 ns</td>
    </tr>
    <tr>
      <td>L2 cache reference:</td>
      <td style="text-align: right;">4 ns</td>
    </tr>
    <tr>
      <td>Main memory reference:</td>
      <td style="text-align: right;">100 ns</td>
    </tr>
    <tr>
    <tr>
      <td rowspan="4" style="text-align: center;">I/O</td>
      <td>SSD random-read:</td>
      <td style="text-align: right;">16,000 ns</td>
    </tr>
    <tr>
      <td>Round-trip in same datacenter:</td>
      <td style="text-align: right;">500,000 ns</td>
    </tr>
    <tr>
      <td>Physical disk seek:</td>
      <td style="text-align: right;">4,000,000 ns</td>
    </tr>
    <tr>
      <td>Round-trip from US to EU:</td>
      <td style="text-align: right;">150,000,000 ns</td>
    </tr>
  </tbody>
</table>


        </section>
      
        <section>
          <h2>The CPU wants to be busy</h2>
<p>An idle CPU is a waste of a valuable resource</p>
<p>Solutions?</p>
<ul>
<li>Multi-process</li>
<li>Threads</li>
<li>Non-blocking I/O</li>
</ul>

        </section>
      
        <section>
          <h2>The UI introduced new challenges</h2>
<p>I/O in the form of a human</p>
<p>Unpredictable</p>
<p><em>Very</em> high latency</p>
<p>Sequential programming has limits</p>

        </section>
      
        <section>
          <h2>Sequential programming for UIs?</h2>
<div class="highlight"><pre><span class="c">#!/bin/sh</span>

<span class="nb">echo</span> -n <span class="s2">&quot;What&#39;s your name? &quot;</span>
<span class="nb">read </span>name
runcmd<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> -n <span class="s2">&quot;OK ${name}, what command shal I run? &quot;</span>
  <span class="nb">read </span>cmd
  <span class="nb">echo</span> <span class="s2">&quot;Here&#39;s the output of the command \`${cmd}\`, ${name}:\n&quot;</span>
  <span class="nv">$cmd</span>
  <span class="nb">echo</span> -n <span class="s2">&quot;\nMore commands ${name}? [Y/n] &quot;</span>
  <span class="nb">read </span>more
  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$more&quot;</span> !<span class="o">=</span> <span class="s2">&quot;n&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">    </span>runcmd
  <span class="k">fi</span>
<span class="o">}</span>
runcmd
</pre></div>


        </section>
      
        <section>
          <h2>Good UIs don&#39;t constrain the user</h2>
<p>Wide range of:</p>
<ul>
<li><p>input devices</p>
</li>
<li><p>user preferences</p>
</li>
<li><p>user abilities</p>
</li>
<li><p>users!</p>
</li>
</ul>

        </section>
      
        <section>
          <h2>Networked UIs: a perfect storm</h2>
<p>User variability delivered over unreliable, high-latency networks</p>
<p>Browsers...</p>

        </section>
      
        <section>
          <h2>On the web, nothing is synchronous</h2>
<p>Reactive programming is king</p>
<ul>
<li>React to user events</li>
<li>React to network events</li>
<li>React to browser events</li>
</ul>

        </section>
      
        <section>
          <h2>JavaScript<br>The King of event-driven programming</h2>
<p>Born in the browser</p>
<p>Designed to respond to user-events</p>
<p><strong>Timers!</strong> &nbsp; <span id="scroll">BREAKING NEWS: Scrolling text with DHTML!         </span></p>
<script>
var p = document.getElementById('scroll');
function scroll () {
  var ptxt = p.innerHTML.replace(/&nbsp;/g, ' ').split('');
  ptxt.push(ptxt.shift());
  p.innerHTML = ptxt.join('').replace(/ /g, '&nbsp;');
}
setInterval(scroll, 100)
</script>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;scroll&#39;</span><span class="p">);</span>
<span class="kd">function</span> <span class="nx">scroll</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">ptxt</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&amp;nbsp;/g</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="nx">ptxt</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">ptxt</span><span class="p">.</span><span class="nx">shift</span><span class="p">());</span>
  <span class="nx">p</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">ptxt</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/ /g</span><span class="p">,</span> <span class="s1">&#39;&amp;nbsp;&#39;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">setInterval</span><span class="p">(</span><span class="nx">scroll</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>

<p style="font-size: 10px; font-style: italic;">Warning: content may trigger intense feelings of nostalgia</p>


        </section>
      
        <section>
          <h2>Asynchronicity at the extreme: Node.js</h2>
<p>Works well for performing many complex, parallel tasks in the browser, why not on the server too?</p>
<p><strong>Async all the things!</strong></p>

        </section>
      
        <section>
          
        </section>
      

      </article>

      <footer>
      </footer>

    </div>

    <script src="js/bespoke.min.js"></script>
    <script src="js/bespoke-keys.min.js"></script>
    <script src="js/bespoke-touch.min.js"></script>
    <script src="js/bespoke-hash.min.js"></script>
    <script src="js/script.js"></script>
  </body>
</script>
</body>